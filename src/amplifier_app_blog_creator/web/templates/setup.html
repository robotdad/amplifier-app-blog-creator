{% extends "base.html" %}

{% block title %}Setup - Blog Creator{% endblock %}

{% block content %}
<div class="setup-container">
    <h1>Create Your Blog Post</h1>
    <p class="subtitle">Provide your writing samples and initial idea to get started.</p>

    <form id="setup-form" hx-post="/sessions/{{ session_id }}/start-workflow" hx-target="body">
        <!-- Idea File Input -->
        <div class="input-group">
            <label for="idea_path" class="input-label">
                <span class="label-text">Brain Dump File</span>
                <span class="label-hint">Full path to markdown or text file with your initial thoughts</span>
            </label>
            <div class="path-input">
                <input
                    type="text"
                    id="idea_path"
                    name="idea_path"
                    class="input-field"
                    placeholder="/Users/you/Documents/blog-idea.md"
                    required
                    list="recent-idea-files"
                >
                <datalist id="recent-idea-files"></datalist>
            </div>
        </div>

        <!-- Writings Directory Input -->
        <div class="input-group">
            <label for="writings_dir" class="input-label">
                <span class="label-text">Writing Samples Directory</span>
                <span class="label-hint">Full path to folder containing your previous blog posts (.md files)</span>
            </label>
            <div class="path-input">
                <input
                    type="text"
                    id="writings_dir"
                    name="writings_dir"
                    class="input-field"
                    placeholder="/Users/you/Documents/blog-posts"
                    required
                    list="recent-writings-dirs"
                >
                <datalist id="recent-writings-dirs"></datalist>
            </div>
        </div>

        <!-- Optional Instructions -->
        <div class="input-group">
            <label for="instructions" class="input-label">
                <span class="label-text">Additional Instructions (Optional)</span>
                <span class="label-hint">Any specific guidance for the AI</span>
            </label>
            <textarea
                id="instructions"
                name="instructions"
                class="textarea-field"
                rows="4"
                placeholder="e.g., 'Focus on technical details' or 'Keep it conversational'"
            ></textarea>
        </div>

        <!-- Actions -->
        <div class="form-actions">
            <button type="submit" class="button button-primary" id="start-btn">
                Start Creation
            </button>
        </div>
    </form>
</div>

<script>
// Load recent paths from previous sessions
async function loadRecentPaths() {
    try {
        const response = await fetch('/sessions/recent-paths');
        const data = await response.json();

        // Populate idea files datalist
        const ideaDatalist = document.getElementById('recent-idea-files');
        data.idea_files.forEach(path => {
            const option = document.createElement('option');
            option.value = path;
            ideaDatalist.appendChild(option);
        });

        // Populate writings directories datalist
        const writingsDatalist = document.getElementById('recent-writings-dirs');
        data.writings_dirs.forEach(path => {
            const option = document.createElement('option');
            option.value = path;
            writingsDatalist.appendChild(option);
        });
    } catch (err) {
        console.log('Could not load recent paths:', err);
    }
}

// Load recent paths on page load
loadRecentPaths();
</script>
{% endblock %}
